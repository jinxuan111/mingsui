<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…«å­—ç®—å‘½å¤§å¸ˆ - ä¸“ä¸šè¿åŠ¿é¢„æµ‹ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 40px 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 50px;
            animation: fadeInDown 0.6s ease;
        }

        h1 {
            font-size: 48px;
            margin-bottom: 15px;
            font-weight: 700;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .subtitle {
            font-size: 18px;
            opacity: 0.95;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1.3fr;
            gap: 40px;
            align-items: start;
        }

        .panel {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: slideInLeft 0.6s ease;
        }

        .result-panel {
            animation: slideInRight 0.6s ease;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #555;
            font-size: 15px;
        }

        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .result-hidden {
            display: none;
        }

        .result-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .result-card h3 {
            color: #667eea;
            font-size: 20px;
            margin-bottom: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        /* å¸åœˆä¸“å±é†’ç›®å¡ç‰‡ï¼ˆå®Œå…¨åŒ¹é…ä½ æˆªå›¾çš„æ·±è‰²+è§å…‰ç»¿é£æ ¼ï¼‰ */
        #cryptoCard {
            background: linear-gradient(135deg, #1e1e2e 0%, #2a1e3b 100%);
            color: #00ff88;
            border: 2px solid #00ff88;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.4);
            font-size: 18px;
            line-height: 2;
            font-weight: 600;
            white-space: pre-line;
        }

        #cryptoCard h3 {
            color: #00ff88;
            font-size: 26px;
            border-bottom: none;
            text-align: center;
            margin-bottom: 30px;
        }

        .bazi-display {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            line-height: 1.8;
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 10px;
        }

        .wuxing-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
        }

        .wuxing-item {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
        }

        .wuxing-wood { background-color: #4CAF50; }
        .wuxing-fire { background-color: #FF6B6B; }
        .wuxing-earth { background-color: #D4A574; }
        .wuxing-metal { background-color: #FFD700; color: #333; }
        .wuxing-water { background-color: #2196F3; }

        .wuxing-count {
            font-size: 32px;
            margin-top: 8px;
        }

        .fortune-bar-container {
            margin-bottom: 25px;
        }

        .fortune-bar-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .fortune-bar {
            width: 100%;
            height: 12px;
            background-color: #E0E0E0;
            border-radius: 6px;
            overflow: hidden;
        }

        .fortune-bar-fill {
            height: 100%;
            border-radius: 6px;
            transition: width 0.8s ease;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        }

        .analysis-text {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            line-height: 1.8;
            color: #444;
            white-space: pre-line;
            font-size: 15px;
        }

        .tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab-btn {
            padding: 12px 24px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            color: #666;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-btn:hover {
            color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-50px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(50px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            h1 { font-size: 36px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>âœ¨ å…«å­—ç®—å‘½å¤§å¸ˆ âœ¨</h1>
            <p class="subtitle">ä¸“ä¸šå…«å­—æ’ç›˜ Â· äº”è¡Œåˆ†æ Â· å¸åœˆåœŸç‹—ä¸“å±è¿åŠ¿</p>
        </header>

        <div class="main-content">
            <!-- è¾“å…¥é¢æ¿ -->
            <div class="panel">
                <h2 style="margin-top: 0; color: #333; font-size: 24px; margin-bottom: 30px;">
                    ğŸ“ è¯·å¡«å†™å‡ºç”Ÿä¿¡æ¯
                </h2>

                <div class="form-group">
                    <label>ğŸ‚ å‡ºç”Ÿå¹´ä»½</label>
                    <input type="number" id="year" min="1900" max="2026" value="1995">
                </div>

                <div class="form-group">
                    <label>ğŸ“… å‡ºç”Ÿæœˆä»½</label>
                    <select id="month">
                        <option value="1">1æœˆ</option><option value="2">2æœˆ</option><option value="3">3æœˆ</option>
                        <option value="4">4æœˆ</option><option value="5">5æœˆ</option><option value="6">6æœˆ</option>
                        <option value="7">7æœˆ</option><option value="8">8æœˆ</option><option value="9">9æœˆ</option>
                        <option value="10">10æœˆ</option><option value="11">11æœˆ</option><option value="12">12æœˆ</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>ğŸ“† å‡ºç”Ÿæ—¥æœŸ</label>
                    <select id="day"></select>
                </div>

                <div class="form-group">
                    <label>ğŸ• å‡ºç”Ÿæ—¶è¾°ï¼ˆå¤§è‡´å³å¯ï¼‰</label>
                    <select id="hour">
                        <option value="0">å­æ—¶ 23-01</option><option value="1">ä¸‘æ—¶ 01-03</option>
                        <option value="3">å¯…æ—¶ 03-05</option><option value="5">å¯æ—¶ 05-07</option>
                        <option value="7">è¾°æ—¶ 07-09</option><option value="9">å·³æ—¶ 09-11</option>
                        <option value="11">åˆæ—¶ 11-13</option><option value="13">æœªæ—¶ 13-15</option>
                        <option value="15">ç”³æ—¶ 15-17</option><option value="17">é…‰æ—¶ 17-19</option>
                        <option value="19">æˆŒæ—¶ 19-21</option><option value="21">äº¥æ—¶ 21-23</option>
                        <option value="12" selected>æœªçŸ¥ï¼ˆå–ä¸­åˆï¼‰</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>ğŸ‘¤ æ€§åˆ«</label>
                    <select id="gender">
                        <option value="male">ç”·</option>
                        <option value="female">å¥³</option>
                    </select>
                </div>

                <button onclick="calculateFortune()">ğŸ”® å¼€å§‹ç®—å‘½</button>
            </div>

            <!-- ç»“æœé¢æ¿ -->
            <div id="resultContainer" class="result-panel result-hidden">
                <div class="tabs">
                    <button class="tab-btn active" onclick="switchTab(event, 'tab-crypto')">ğŸ”¥ å¸åœˆÂ·åœŸç‹—è¿åŠ¿</button>
                    <button class="tab-btn" onclick="switchTab(event, 'tab-basic')">åŸºç¡€ä¿¡æ¯</button>
                    <button class="tab-btn" onclick="switchTab(event, 'tab-fortune')">è¿åŠ¿æŒ‡æ•°</button>
                    <button class="tab-btn" onclick="switchTab(event, 'tab-detail')">è¯¦ç»†æŠ¥å‘Š</button>
                </div>

                <!-- å¸åœˆÂ·åœŸç‹—è¿åŠ¿ï¼ˆç¬¬ä¸€ä¸ªTabï¼Œé»˜è®¤æ‰“å¼€ï¼‰ -->
                <div id="tab-crypto" class="tab-content active">
                    <div id="cryptoCard">
                        <h3>ğŸ”¥ å¸åœˆÂ·åœŸç‹—è¿åŠ¿ï¼ˆä»Šå¤©é€‚åˆæ‰“åœŸç‹—å—ï¼Ÿï¼‰</h3>
                        <div id="cryptoAdvice"></div>
                    </div>
                </div>

                <!-- åŸºç¡€ä¿¡æ¯ -->
                <div id="tab-basic" class="tab-content">
                    <div class="result-card">
                        <h3>ğŸ“Š å…«å­—æ’ç›˜</h3>
                        <div id="baziDisplay" class="bazi-display"></div>
                    </div>

                    <div class="result-card">
                        <h3>ğŸŒŠ äº”è¡Œåˆ†å¸ƒ</h3>
                        <div id="wuxingGrid" class="wuxing-grid"></div>
                    </div>
                </div>

                <!-- è¿åŠ¿æŒ‡æ•° -->
                <div id="tab-fortune" class="tab-content">
                    <div class="result-card">
                        <h3>ğŸ¯ ç»¼åˆè¿åŠ¿æŒ‡æ•°</h3>
                        <div class="fortune-bar-container">
                            <div class="fortune-bar-label"><span>ç»¼åˆè¿åŠ¿</span><span id="overallValue">0%</span></div>
                            <div class="fortune-bar"><div id="overallBar" class="fortune-bar-fill" style="width:0%"></div></div>
                        </div>
                        <div class="fortune-bar-container">
                            <div class="fortune-bar-label"><span>è´¢è¿</span><span id="wealthValue">0%</span></div>
                            <div class="fortune-bar"><div id="wealthBar" class="fortune-bar-fill" style="width:0%"></div></div>
                        </div>
                        <div class="fortune-bar-container">
                            <div class="fortune-bar-label"><span>äº‹ä¸šè¿</span><span id="careerValue">0%</span></div>
                            <div class="fortune-bar"><div id="careerBar" class="fortune-bar-fill" style="width:0%"></div></div>
                        </div>
                        <div class="fortune-bar-container">
                            <div class="fortune-bar-label"><span>æ„Ÿæƒ…è¿</span><span id="loveValue">0%</span></div>
                            <div class="fortune-bar"><div id="loveBar" class="fortune-bar-fill" style="width:0%"></div></div>
                        </div>
                        <div class="fortune-bar-container">
                            <div class="fortune-bar-label"><span>å¥åº·è¿</span><span id="healthValue">0%</span></div>
                            <div class="fortune-bar"><div id="healthBar" class="fortune-bar-fill" style="width:0%"></div></div>
                        </div>
                    </div>
                </div>

                <!-- è¯¦ç»†æŠ¥å‘Šï¼ˆå·²ç§»é™¤å¸åœˆå†…å®¹ï¼‰ -->
                <div id="tab-detail" class="tab-content">
                    <div class="result-card"><h3>åŸºç¡€ä¿¡æ¯</h3><div id="basicInfo" class="analysis-text"></div></div>
                    <div class="result-card"><h3>å…«å­—åˆ†æ</h3><div id="baziAnalysis" class="analysis-text"></div></div>
                    <div class="result-card"><h3>äº”è¡Œåˆ†æ</h3><div id="wuxingAnalysis" class="analysis-text"></div></div>
                    <div class="result-card"><h3>ç»¼åˆè¿åŠ¿</h3><div id="fortuneAnalysis" class="analysis-text"></div></div>
                    <div class="result-card"><h3>è´¢è¿åˆ†æ</h3><div id="wealthAnalysis" class="analysis-text"></div></div>
                    <div class="result-card"><h3>äº‹ä¸šåˆ†æ</h3><div id="careerAnalysis" class="analysis-text"></div></div>
                    <div class="result-card"><h3>æ„Ÿæƒ…åˆ†æ</h3><div id="loveAnalysis" class="analysis-text"></div></div>
                    <div class="result-card"><h3>å¥åº·å»ºè®®</h3><div id="healthAdvice" class="analysis-text"></div></div>
                    <div class="result-card"><h3>é€æœˆè¿åŠ¿</h3><div id="monthlyFortune" class="analysis-text"></div></div>
                    <div class="result-card"><h3>æ”¹è¿å»ºè®®</h3><div id="improveAdvice" class="analysis-text"></div></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class FortuneEngine {
            constructor() {
                this.heavenStems = ['ç”²', 'ä¹™', 'ä¸™', 'ä¸', 'æˆŠ', 'å·±', 'åºš', 'è¾›', 'å£¬', 'ç™¸'];
                this.earthBranches = ['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥'];
                this.stemWuXing = { 'ç”²': 'æœ¨', 'ä¹™': 'æœ¨', 'ä¸™': 'ç«', 'ä¸': 'ç«', 'æˆŠ': 'åœŸ', 'å·±': 'åœŸ', 'åºš': 'é‡‘', 'è¾›': 'é‡‘', 'å£¬': 'æ°´', 'ç™¸': 'æ°´' };
                this.branchWuXing = { 'å­': 'æ°´', 'ä¸‘': 'åœŸ', 'å¯…': 'æœ¨', 'å¯': 'æœ¨', 'è¾°': 'åœŸ', 'å·³': 'ç«', 'åˆ': 'ç«', 'æœª': 'åœŸ', 'ç”³': 'é‡‘', 'é…‰': 'é‡‘', 'æˆŒ': 'åœŸ', 'äº¥': 'æ°´' };
            }

            yearToGanZhi(year) {
                const stemIndex = (year - 4) % 10;
                const branchIndex = (year - 4) % 12;
                return this.heavenStems[stemIndex] + this.earthBranches[branchIndex];
            }

            monthToGanZhi(year, month) {
                const yearGanZhi = this.yearToGanZhi(year);
                const yearStemIndex = this.heavenStems.indexOf(yearGanZhi[0]);
                const monthStemIndex = (yearStemIndex * 2 + month + 1) % 10;
                const monthBranchIndex = month - 1;
                return this.heavenStems[monthStemIndex] + this.earthBranches[monthBranchIndex];
            }

            dayToGanZhi(year, month, day) {
                const base = new Date(1900, 0, 31);
                const current = new Date(year, month - 1, day);
                const days = Math.floor((current - base) / 86400000);
                const stemIndex = (days + 60) % 10;
                const branchIndex = (days + 60) % 12;
                return this.heavenStems[stemIndex] + this.earthBranches[branchIndex];
            }

            hourToGanZhi(dayGanZhi, hour) {
                const dayStemIndex = this.heavenStems.indexOf(dayGanZhi[0]);
                const hourBranchMap = [0,1,2,3,4,5,6,7,8,9,10,11];
                let hourBranchIndex = hourBranchMap[Math.floor(hour / 2)];
                if (hour === 23 || hour === 0) hourBranchIndex = 0;
                const hourStemIndex = (dayStemIndex * 2 + hourBranchIndex) % 10;
                return this.heavenStems[hourStemIndex] + this.earthBranches[hourBranchIndex];
            }

            getBaZi(year, month, day, hour) {
                const y = this.yearToGanZhi(year);
                const m = this.monthToGanZhi(year, month);
                const d = this.dayToGanZhi(year, month, day);
                const h = this.hourToGanZhi(d, hour);
                return { year: y, month: m, day: d, hour: h, full: `${y} ${m} ${d} ${h}` };
            }

            getWuXingCount(baZi) {
                const chars = (baZi.year + baZi.month + baZi.day + baZi.hour);
                const count = { 'æœ¨': 0, 'ç«': 0, 'åœŸ': 0, 'é‡‘': 0, 'æ°´': 0 };
                for (let c of chars) {
                    if (this.stemWuXing[c]) count[this.stemWuXing[c]]++;
                    if (this.branchWuXing[c]) count[this.branchWuXing[c]]++;
                }
                return count;
            }

            calculateDayMasterStrength(baZi) {
                const dm = baZi.day[0];
                const wx = this.stemWuXing[dm];
                let strength = 50;
                ['year','month','day','hour'].forEach(p => {
                    if (this.stemWuXing[baZi[p][0]] === wx) strength += (p === 'day' ? 30 : p === 'month' ? 20 : 15);
                    if (this.branchWuXing[baZi[p][1]] === wx) strength += (p === 'day' ? 20 : p === 'month' ? 15 : 10);
                });
                return Math.min(Math.round(strength), 100);
            }

            generateFortune(year, month, day, hour, gender) {
                const baZi = this.getBaZi(year, month, day, hour);
                const wuXingCount = this.getWuXingCount(baZi);
                const dayMasterStrength = this.calculateDayMasterStrength(baZi);
                const dayMasterWuXing = this.stemWuXing[baZi.day[0]];
                const today = new Date();
                let age = today.getFullYear() - year;
                if (today.getMonth() + 1 < month || (today.getMonth() + 1 === month && today.getDate() < day)) age--;

                const max = Math.max(...Object.values(wuXingCount));
                const min = Math.min(...Object.values(wuXingCount));
                const balance = max === 0 ? 50 : Math.round(100 - (max - min) * 12.5);

                const indices = {
                    overall: Math.round((dayMasterStrength + balance) / 2),
                    wealth: Math.min(Math.round((wuXingCount['æœ¨'] + wuXingCount['ç«']) * 12), 100),
                    career: Math.round(balance * 0.9),
                    love: Math.round(balance * 0.85),
                    health: dayMasterStrength,
                    balance: balance
                };

                return { baZi, wuXingCount, dayMasterStrength, dayMasterWuXing, age, gender, fortuneIndices: indices };
            }
        }

        class DetailedAnalysisGenerator {
            constructor() {
                this.wuXingDescriptions = {
                    'æœ¨': { åç§°: 'æœ¨', é¢œè‰²: 'ç»¿è‰²', æ–¹å‘: 'ä¸œæ–¹', å­£èŠ‚: 'æ˜¥å­£', å™¨å®˜: 'è‚èƒ†', æƒ…ç»ª: 'æ€’', å‘³é“: 'é…¸' },
                    'ç«': { åç§°: 'ç«', é¢œè‰²: 'çº¢è‰²', æ–¹å‘: 'å—æ–¹', å­£èŠ‚: 'å¤å­£', å™¨å®˜: 'å¿ƒè„‘', æƒ…ç»ª: 'å–œ', å‘³é“: 'è‹¦' },
                    'åœŸ': { åç§°: 'åœŸ', é¢œè‰²: 'é»„è‰²', æ–¹å‘: 'ä¸­å¤®', å­£èŠ‚: 'å››å­£æœ«', å™¨å®˜: 'è„¾èƒƒ', æƒ…ç»ª: 'æ€', å‘³é“: 'ç”˜' },
                    'é‡‘': { åç§°: 'é‡‘', é¢œè‰²: 'ç™½è‰²', æ–¹å‘: 'è¥¿æ–¹', å­£èŠ‚: 'ç§‹å­£', å™¨å®˜: 'è‚ºè‚ ', æƒ…ç»ª: 'æ‚²', å‘³é“: 'è¾›' },
                    'æ°´': { åç§°: 'æ°´', é¢œè‰²: 'é»‘è‰²', æ–¹å‘: 'åŒ—æ–¹', å­£èŠ‚: 'å†¬å­£', å™¨å®˜: 'è‚¾è†€èƒ±', æƒ…ç»ª: 'æ', å‘³é“: 'å’¸' }
                };
            }

            generateFullReport(fortune) {
                return {
                    åŸºç¡€ä¿¡æ¯: this.generateBasicInfo(fortune),
                    å…«å­—åˆ†æ: this.generateBaZiAnalysis(fortune),
                    äº”è¡Œåˆ†æ: this.generateWuXingAnalysis(fortune),
                    è¿åŠ¿åˆ†æ: this.generateFortuneAnalysis(fortune),
                    è´¢è¿åˆ†æ: this.generateWealthAnalysis(fortune),
                    äº‹ä¸šåˆ†æ: this.generateCareerAnalysis(fortune),
                    æ„Ÿæƒ…åˆ†æ: this.generateLoveAnalysis(fortune),
                    å¥åº·å»ºè®®: this.generateHealthAdvice(fortune),
                    å¸åœˆåœŸç‹—è¿åŠ¿: this.generateCryptoAdvice(fortune),
                    é€æœˆè¿åŠ¿: this.generateMonthlyFortune(fortune),
                    æ”¹è¿å»ºè®®: this.generateImproveAdvice(fortune)
                };
            }

            generateBasicInfo(fortune) {
                return `å¹´é¾„ï¼š${fortune.age}å²\næ€§åˆ«ï¼š${fortune.gender === 'male' ? 'ç”·' : 'å¥³'}\nå…«å­—ï¼š${fortune.baZi.full}\næ—¥ä¸»ï¼š${fortune.baZi.day}\næ—¥ä¸»äº”è¡Œï¼š${fortune.dayMasterWuXing}\næ—¥ä¸»å¼ºå¼±ï¼š${fortune.dayMasterStrength}åˆ†`;
            }

            generateBaZiAnalysis(fortune) {
                const { baZi, dayMasterStrength, dayMasterWuXing } = fortune;
                let text = `ä½ çš„å…«å­—ä¸ºï¼š${baZi.full}\n\næ—¥ä¸»ï¼ˆæ—¥å¹²ï¼‰ä¸º${baZi.day[0]}ï¼Œå±${dayMasterWuXing}æ€§ã€‚\n\n`;
                if (dayMasterStrength > 70) text += `æ—¥ä¸»éå¸¸æ—ºç››ï¼ˆ${dayMasterStrength}åˆ†ï¼‰ï¼Œå¤©ç”Ÿè‡ªä¿¡ã€è¡ŒåŠ¨åŠ›å¼ºã€é¢†å¯¼åŠ›çªå‡ºã€‚ä½ æ˜¯å¤©ç”Ÿçš„é¢†å¯¼è€…ï¼Œå…·æœ‰æå¼ºçš„æ‰§è¡ŒåŠ›ã€‚`;
                else if (dayMasterStrength > 55) text += `æ—¥ä¸»è¾ƒæ—ºï¼ˆ${dayMasterStrength}åˆ†ï¼‰ï¼Œå…·å¤‡è‰¯å¥½è‡ªæˆ‘ç®¡ç†èƒ½åŠ›ï¼Œæ€§æ ¼ç¨³å¥ï¼Œäººæ ¼å¥å…¨ã€‚`;
                else if (dayMasterStrength > 40) text += `æ—¥ä¸»ä¸­ç­‰ï¼ˆ${dayMasterStrength}åˆ†ï¼‰ï¼Œæ€§æ ¼æ¸©å’Œï¼Œé€‚åº”åŠ›å¼ºï¼Œå–„äºåˆä½œã€‚`;
                else text += `æ—¥ä¸»åå¼±ï¼ˆ${dayMasterStrength}åˆ†ï¼‰ï¼Œéœ€å€ŸåŠ©å¤–åŠ›ä¸è´µäººï¼Œå®œå¤šå»ºç«‹äººè„‰ã€‚`;
                return text;
            }

            generateWuXingAnalysis(fortune) {
                const { wuXingCount } = fortune;
                const total = Object.values(wuXingCount).reduce((a,b)=>a+b,0);
                let text = 'äº”è¡Œåˆ†å¸ƒï¼š\n\n';
                for (let [wx, cnt] of Object.entries(wuXingCount)) {
                    const pct = Math.round(cnt/total*100);
                    const d = this.wuXingDescriptions[wx];
                    text += `${d.åç§°}ï¼š${cnt}ä¸ªï¼ˆ${pct}%ï¼‰ â†’ ${d.æ–¹å‘}ã€${d.å­£èŠ‚}ã€${d.å™¨å®˜}\n`;
                }
                const diff = Math.max(...Object.values(wuXingCount)) - Math.min(...Object.values(wuXingCount));
                text += '\näº”è¡Œå¹³è¡¡åº¦ï¼š\n';
                if (diff <= 2) text += 'éå¸¸å‡è¡¡ï¼Œå…ˆå¤©æ¡ä»¶æä½³ï¼Œæ€§æ ¼å¹³å’Œï¼Œå‘å±•å…¨é¢ã€‚';
                else if (diff <= 4) text += 'åŸºæœ¬å‡è¡¡ï¼Œç¨ä½œè°ƒç†å³å¯å…¨é¢å‘å±•ã€‚';
                else text += 'æœ‰æ‰€å¤±è¡¡ï¼Œéœ€é’ˆå¯¹æ€§è¡¥æ•‘çŸ­æ¿ã€‚';
                return text;
            }

            generateFortuneAnalysis(fortune) {
                const overall = fortune.fortuneIndices.overall;
                let text = `ç»¼åˆè¿åŠ¿æŒ‡æ•°ï¼š${overall}/100\n\nè¯¦ç»†æŒ‡æ•°ï¼š\nè´¢è¿ï¼š${fortune.fortuneIndices.wealth}/100\näº‹ä¸šï¼š${fortune.fortuneIndices.career}/100\næ„Ÿæƒ…ï¼š${fortune.fortuneIndices.love}/100\nå¥åº·ï¼š${fortune.fortuneIndices.health}/100`;
                return text;
            }

            generateWealthAnalysis(fortune) {
                const strength = fortune.dayMasterStrength;
                let text = 'è´¢è¿åˆ†æï¼š\n\n';
                if (strength > 70) text += 'æ—¥ä¸»å¼ºåŠ¿ï¼Œèšè´¢èƒ½åŠ›å¼ºï¼Œé€‚åˆåˆ›ä¸šæŠ•èµ„ï¼ŒæŠŠæ¡å•†æœºå¯å¤§å¯Œã€‚';
                else if (strength < 40) text += 'æ—¥ä¸»åå¼±ï¼Œå®œå®ˆæ­£è´¢ï¼Œç¨³å®šæ”¶å…¥ä¸ºä¸»ï¼Œé¿å…æŠ•æœºã€‚';
                else text += 'è´¢è¿ä¸­ç­‰ï¼Œå¯ç¨³ä¸­æ±‚è¿›ï¼Œé€‚åº¦ç†è´¢ã€‚';
                text += `\nä»Šå¹´è´¢è¿æŒ‡æ•°ï¼š${fortune.fortuneIndices.wealth}/100`;
                return text;
            }

            generateCareerAnalysis(fortune) {
                const wx = fortune.dayMasterWuXing;
                const paths = {
                    'æœ¨': ['æ•™è‚²ã€åŒ»ç–—ã€æ—ä¸šã€è®¾è®¡ã€ç®¡ç†'],
                    'ç«': ['èƒ½æºã€ç§‘æŠ€ã€ä¼ åª’ã€è¥é”€ã€æ³•å¾‹'],
                    'åœŸ': ['åœ°äº§ã€å»ºç­‘ã€å†œä¸šã€å…¬åŠ¡å‘˜'],
                    'é‡‘': ['é‡‘èã€æœºæ¢°ã€å†›è­¦ã€ç å®'],
                    'æ°´': ['è´¸æ˜“ã€æ—…æ¸¸ã€ç‰©æµã€ITã€è‰ºæœ¯']
                };
                let text = `é€‚åˆè¡Œä¸šï¼ˆä¾æ®${wx}å±æ€§ï¼‰ï¼š\n` + (paths[wx] || ['å¤šå…ƒè¡Œä¸š']).map((p,i)=>`${i+1}. ${p}`).join('\n') + '\n\n';
                if (fortune.dayMasterStrength > 70) text += 'å®œåˆ›ä¸šæˆ–é«˜å±‚ç®¡ç†ï¼Œé¢†å¯¼åŠ›å¼ºã€‚';
                else if (fortune.dayMasterStrength < 40) text += 'å®œç¨³å®šå¤§å¹³å°ï¼Œå€Ÿè´µäººä¹‹åŠ›ã€‚';
                else text += 'å¯åˆ›ä¸šä¹Ÿå¯æ·±è€•ä¸“ä¸šé¢†åŸŸã€‚';
                return text;
            }

            generateLoveAnalysis(fortune) {
                const traits = {
                    'æœ¨': 'çƒ­æƒ…ç›´ç‡ï¼Œä½†æ˜“å›ºæ‰§ã€‚éœ€å¤šå€¾å¬ä¸åŒ…å®¹ã€‚',
                    'ç«': 'æµªæ¼«æ¿€æƒ…ï¼Œä½†æƒ…ç»ªåŒ–ã€‚éœ€å¢åŠ è€å¿ƒã€‚',
                    'åœŸ': 'å¿ è¯šå¯é ï¼Œä½†å°‘æµªæ¼«ã€‚éœ€å¤šè¡¨è¾¾æƒ…æ„Ÿã€‚',
                    'é‡‘': 'ç†æ€§ä¸“ä¸€ï¼Œä½†æ˜¾å†·æ·¡ã€‚éœ€ä¸»åŠ¨ç¤ºæš–ã€‚',
                    'æ°´': 'æ¸©æŸ”ä½“è´´ï¼Œä½†å¤šæ•æ„Ÿã€‚éœ€å¢å¼ºè‡ªä¿¡ã€‚'
                };
                let text = `æ„Ÿæƒ…ç‰¹è´¨ï¼š${traits[fortune.dayMasterWuXing] || 'éœ€ç”¨å¿ƒç»è¥'}\n\nä»Šå¹´æ„Ÿæƒ…è¿ï¼š${fortune.fortuneIndices.love > 70 ? 'æä½³ï¼Œæ˜“é‡æ­£ç¼˜æˆ–å©šå§»ç¾æ»¡' : fortune.fortuneIndices.love > 50 ? 'å¹³ç¨³ï¼Œå¯é‡è‰¯ç¼˜' : 'éœ€ä¸»åŠ¨ï¼Œå¤šæ²Ÿé€š'}`;
                return text;
            }

            generateHealthAdvice(fortune) {
                const tips = {
                    'æœ¨': {å™¨å®˜:'è‚èƒ†', æ³¨æ„:'é˜²æ€’ä¼¤è‚ã€è¿‡åº¦åŠ³ç´¯', è°ƒç†:'æ˜¥å­£è¿åŠ¨ã€å¤šç»¿æ¤'},
                    'ç«': {å™¨å®˜:'å¿ƒè¡€ç®¡', æ³¨æ„:'é˜²å¿ƒç«ã€ä¸Šç«', è°ƒç†:'å¤å­£æ¸…çƒ­ã€é™å¿ƒ'},
                    'åœŸ': {å™¨å®˜:'è„¾èƒƒ', æ³¨æ„:'é¥®é£Ÿè§„å¾‹ã€é˜²æ¹¿é‡', è°ƒç†:'å¥è„¾ç¥›æ¹¿'},
                    'é‡‘': {å™¨å®˜:'è‚ºå‘¼å¸', æ³¨æ„:'é˜²ç§‹ç‡¥ã€æ‚²ä¼¤', è°ƒç†:'æ¶¦è‚ºå…»é˜´'},
                    'æ°´': {å™¨å®˜:'è‚¾æ³Œå°¿', æ³¨æ„:'é˜²å¯’ã€è‚¾è™š', è°ƒç†:'å†¬å­£è¡¥è‚¾ã€ä¿æš–'}
                };
                const t = tips[fortune.dayMasterWuXing];
                return `é‡ç‚¹å…³æ³¨ï¼š${t.å™¨å®˜}\næ³¨æ„äº‹é¡¹ï¼š${t.æ³¨æ„}\nè°ƒç†å»ºè®®ï¼š${t.è°ƒç†}\nä»Šå¹´å¥åº·æŒ‡æ•°ï¼š${fortune.fortuneIndices.health}/100`;
            }

            generateCryptoAdvice(fortune) {
                const wealth = fortune.fortuneIndices.wealth;
                const overall = fortune.fortuneIndices.overall;
                const wx = fortune.dayMasterWuXing;
                const strength = fortune.dayMasterStrength;

                let advice = 'ğŸ”¥ å¸åœˆÂ·åœŸç‹—è¿åŠ¿åˆ†æï¼ˆçº¯å¨±ä¹ï¼ŒæŠ•èµ„æœ‰é£é™©ï¼‰ ğŸ”¥\n\n';

                const wxStyle = {
                    'æœ¨': 'æˆé•¿å‹é¡¹ç›®ï¼Œé€‚åˆé•¿çº¿åŸ‹ä¼æ–°å™äº‹ï¼ˆå¦‚Layer2ã€AIé“¾ï¼‰',
                    'ç«': 'çƒ­ç‚¹çˆ†ç‚’ï¼Œä»Šå¤©å®¹æ˜“çŸ­çº¿åƒè‚‰ï¼ˆmemeã€çƒ­æœæ¦‚å¿µï¼‰',
                    'åœŸ': 'å®œæŒè“ç­¹ç¨³å®šå¸ï¼ŒåœŸç‹—é£é™©é«˜ï¼ˆBTC/ETHä¸ºä¸»ï¼‰',
                    'é‡‘': 'é«˜é£é™©é«˜æ”¶ç›Šï¼Œé€‚åˆé‡ä»“æ¢­å“ˆæ½œåŠ›å®çŸ³',
                    'æ°´': 'æµåŠ¨æ€§å¼ºï¼Œé€‚åˆå¿«è¿›å¿«å‡ºæ³¢æ®µï¼ˆDEXã€è¡ç”Ÿå“ï¼‰'
                };
                advice += `ä½ çš„æ—¥ä¸»äº”è¡Œã€${wx}ã€‘ï¼š${wxStyle[wx] || 'çµæ´»åº”å˜ï¼Œéšæœºåº”å˜'}\n\n`;

                if (wealth > 85 && overall > 75) {
                    advice += 'âš¡âš¡ ä»Šæ—¥åœŸç‹—è¿æä½³ï¼è´¢æ˜Ÿé«˜ç…§ï¼Œè´µäººè¿çˆ†æ£šï¼\néå¸¸é€‚åˆæ‰“åœŸç‹—ã€ä¸Šæ–°ã€ä¸Šæ‰€é¡¹ç›®ï¼Œå®¹æ˜“åƒåˆ°å¤§è‚‰ï¼\nå»ºè®®ï¼šé‡ä»“æ½œåŠ› meme / æ–°å™äº‹ï¼Œæ•¢æ¢­å“ˆæ•¢æš´å¯Œï¼\nâš ï¸ è®°å¾—è§å¥½å°±æ”¶ï¼Œè½è¢‹ä¸ºå®‰ï¼';
                } else if (wealth > 70) {
                    advice += 'ğŸ”¥ åœŸç‹—è¿å¾ˆä¸é”™ï¼Œæœ‰å°æƒŠå–œï¼\nä»Šå¤©é€‚åˆæ‰“åœŸç‹—ï¼Œè½»ä»“è¯•æ°´çƒ­ç‚¹é¡¹ç›®å¾ˆå®¹æ˜“åƒè‚‰ã€‚\næ¨èå…³æ³¨ Solana/Base/BSC æ–° memeï¼Œè·ŸKOLèµ°å¤§æ¦‚ç‡ç›ˆåˆ©ã€‚\nç­–ç•¥ï¼šè®¾ç½®æ­¢ç›ˆæ­¢æŸï¼Œç©å¾—å¼€å¿ƒã€‚';
                } else if (wealth > 50) {
                    advice += 'ğŸ“Š åœŸç‹—è¿ä¸­ç­‰ï¼Œå¸‚åœºéœ‡è¡ã€‚\nå¯ä»¥å°ç©æ€¡æƒ…ï¼Œä½†ä¸å»ºè®®é‡ä»“æ‰“åœŸç‹—ã€‚\næ›´é€‚åˆåŸ‹ä¼è“ç­¹æˆ–è€ memeï¼Œé¿å…è¿½é«˜ã€‚\nè€å¿ƒç­‰å›è°ƒå†å‡ºæ‰‹ã€‚';
                } else if (wealth > 30) {
                    advice += 'âš ï¸ åœŸç‹—è¿åå¼±ï¼Œå®¹æ˜“è¢«å‰²ã€‚\nä»Šå¤©ä¸å»ºè®®æ‰“æ–°åœŸç‹—ï¼Œå®¹æ˜“ç«™å²—ã€‚\næ¨èè§‚æœ›æˆ–åªç”¨å¨±ä¹èµ„é‡‘ç©è€é¡¹ç›®ã€‚\nå¤šå­¦ä¹ ï¼Œç­‰å¾…æ›´å¥½æ—¶æœºã€‚';
                } else {
                    advice += 'â„ï¸ ä»Šæ—¥åœŸç‹—è¿å¾ˆå·®ï¼Œå¼ºçƒˆä¸å»ºè®®æ‰“åœŸç‹—ï¼\nå®¹æ˜“æ¥ç›˜ã€è¢«å¥—ï¼ŒFOMO å¿…äºã€‚\nå»ºè®®æŒå¸ä¼‘æ¯ï¼Œæˆ–åªæŒ BTC/ETH å¤§å¸ã€‚\nè€å¿ƒç­‰å¤§è¿åˆ°æ¥ï¼Œå¸åœˆæœ€å¿Œæ€¥èºã€‚';
                }

                advice += `\n\nä»Šæ—¥è´¢è¿æŒ‡æ•°ï¼š${wealth}/100ï¼ˆè¶Šé«˜è¶Šé€‚åˆæŠ•æœºï¼‰`;

                if (strength > 70) {
                    advice += '\næ—¥ä¸»å¼ºåŠ¿ï¼šä½ å¤©ç”Ÿé€‚åˆé«˜é£é™©æ“ä½œï¼ŒæŠŠæ¡èŠ‚å¥æ˜“å¤§æˆï¼';
                } else if (strength < 40) {
                    advice += '\næ—¥ä¸»åå¼±ï¼šå»ºè®®ä¿å®ˆç­–ç•¥ï¼Œé¿å…è¿‡åº¦æŠ•æœºã€‚';
                }

                return advice;
            }

            generateMonthlyFortune(fortune) {
                const months = ['1','2','3','4','5','6','7','8','9','10','11','12'];
                let text = '2026å¹´é€æœˆè¿åŠ¿ç®€è¯„ï¼š\n\n';
                months.forEach((m,i) => {
                    const score = Math.round(50 + Math.sin(i) * 20 + fortune.age % 10 * 3 + i * 2);
                    const level = score > 75 ? 'æä½³' : score > 60 ? 'é¡ºåˆ©' : score > 45 ? 'å¹³ç¨³' : 'æ³¨æ„';
                    text += `${m}æœˆï¼š${score}åˆ† - ${level}\n`;
                });
                return text;
            }

            generateImproveAdvice(fortune) {
                const color = { 'æœ¨':'ç»¿è‰²', 'ç«':'çº¢è‰²', 'åœŸ':'é»„è‰²', 'é‡‘':'ç™½è‰²', 'æ°´':'é»‘è‰²' }[fortune.dayMasterWuXing];
                return `1. é¢œè‰²è°ƒç†ï¼šå¤šç©¿${color}ç³»è¡£ç‰©ã€è£…é¥°\n2. æ–¹ä½è°ƒç†ï¼šå®œå‘${this.wuXingDescriptions[fortune.dayMasterWuXing].æ–¹å‘}å‘å±•\n3. ç”Ÿæ´»ä¹ æƒ¯ï¼šæ—©ç¡æ—©èµ·ã€é€‚åº¦è¿åŠ¨ã€è¡Œå–„ç§¯å¾·\n4. äººé™…è´µäººï¼šå¤šç»“å–„ç¼˜ï¼Œå¯»æ±‚æ—¥ä¸»åŒäº”è¡Œä¹‹äººç›¸åŠ©`;
            }
        }

        const engine = new FortuneEngine();
        const generator = new DetailedAnalysisGenerator();

        function calculateFortune() {
            const year = parseInt(document.getElementById('year').value);
            const month = parseInt(document.getElementById('month').value);
            const day = parseInt(document.getElementById('day').value);
            const hour = parseInt(document.getElementById('hour').value);
            const gender = document.getElementById('gender').value;

            const fortune = engine.generateFortune(year, month, day, hour, gender);
            const report = generator.generateFullReport(fortune);

            document.getElementById('resultContainer').classList.remove('result-hidden');

            document.getElementById('baziDisplay').innerHTML = `
                <div>å¹´æŸ±ï¼š${fortune.baZi.year}</div>
                <div>æœˆæŸ±ï¼š${fortune.baZi.month}</div>
                <div>æ—¥æŸ±ï¼š${fortune.baZi.day}</div>
                <div>æ—¶æŸ±ï¼š${fortune.baZi.hour}</div>
            `;

            const wxOrder = ['æœ¨','ç«','åœŸ','é‡‘','æ°´'];
            const wxClass = { 'æœ¨':'wood','ç«':'fire','åœŸ':'earth','é‡‘':'metal','æ°´':'water' };
            document.getElementById('wuxingGrid').innerHTML = wxOrder.map(w => `
                <div class="wuxing-item wuxing-${wxClass[w]}">
                    <div>${w}</div>
                    <div class="wuxing-count">${fortune.wuXingCount[w]}</div>
                </div>
            `).join('');

            const idx = fortune.fortuneIndices;
            ['overall','wealth','career','love','health'].forEach(k => {
                document.getElementById(k+'Value').textContent = idx[k] + '%';
                document.getElementById(k+'Bar').style.width = idx[k] + '%';
            });

            document.getElementById('basicInfo').textContent = report.åŸºç¡€ä¿¡æ¯;
            document.getElementById('baziAnalysis').textContent = report.å…«å­—åˆ†æ;
            document.getElementById('wuxingAnalysis').textContent = report.äº”è¡Œåˆ†æ;
            document.getElementById('fortuneAnalysis').textContent = report.è¿åŠ¿åˆ†æ;
            document.getElementById('wealthAnalysis').textContent = report.è´¢è¿åˆ†æ;
            document.getElementById('careerAnalysis').textContent = report.äº‹ä¸šåˆ†æ;
            document.getElementById('loveAnalysis').textContent = report.æ„Ÿæƒ…åˆ†æ;
            document.getElementById('healthAdvice').textContent = report.å¥åº·å»ºè®®;
            document.getElementById('cryptoAdvice').textContent = report.å¸åœˆåœŸç‹—è¿åŠ¿;
            document.getElementById('monthlyFortune').textContent = report.é€æœˆè¿åŠ¿;
            document.getElementById('improveAdvice').textContent = report.æ”¹è¿å»ºè®®;

            switchTab(null, 'tab-crypto');
        }

        function switchTab(e, tabName) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            if (e) e.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`.tab-btn[onclick="switchTab(event, '${tabName}')"]`).classList.add('active');
        }

        function initDays() {
            const daySelect = document.getElementById('day');
            daySelect.innerHTML = '';
            const daysInMonth = new Date(document.getElementById('year').value, document.getElementById('month').value, 0).getDate();
            for (let i = 1; i <= daysInMonth; i++) {
                daySelect.innerHTML += `<option value="${i}">${i}æ—¥</option>`;
            }
        }
        document.getElementById('year').addEventListener('change', initDays);
        document.getElementById('month').addEventListener('change', initDays);
        initDays();
        document.getElementById('day').value = new Date().getDate();
    </script>
</body>
</html>